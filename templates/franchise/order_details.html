{% extends 'official/partials/base.html' %}
{% block content %}
{% load static humanize crispy_forms_tags %}

<div class="row page-titles mx-0 align-items-center px-2 py-2">
    <div class="col-sm-6 p-md-0">
        <div class="welcome-text">
            <h4>Product Details</h4>
        </div>
    </div>
    <div class="col-sm-6 p-md-0 justify-content-sm-end mt-2 mt-sm-0 d-flex">
        {% if request_details.is_franchise_accepted %}
        {% if request_details.pickupboy %}
        <a class="btn btn-primary" href="javascript:void();" data-bs-toggle="modal"
            data-bs-target="#franchiseSetModal">Edit Pickup Boy
        </a>
        {% else %}
        <a class="btn btn-primary" href="javascript:void();" data-bs-toggle="modal"
            data-bs-target="#franchiseSetModal">Set Pickup Boy
        </a>
        {% endif %}
        {% else %}
        <button class="btn btn-success" data-url="{% url 'franchise:accept_order' request_details.id %}" type="button"
            id="acceptButton">Accept Request
        </button>
        {% endif %}
    </div>
</div>

<div class="modal fade" id="franchiseSetModal">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <!-- <h5 class="modal-title">Modal title</h5> -->
                <button type="button" class="btn-close" data-bs-dismiss="modal">
                </button>
            </div>
            <div class="modal-body text-center">
                <form action="" method="post">
                    {% csrf_token %}
                    {{form|crispy}}
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>


<div class="row">
    <div class="col-xl-12 col-12">

        <div class="card">
            <div class="card-body">
                <div class="my-post-content">
                    <div class="profile-personal-info">
                        <h4 class="text-primary mb-4">Personal Information</h4>
                        {% if request_details.is_franchise_accepted %}
                        <div class="row mb-2">
                            <div class="col-sm-3 col-5">
                                <h5 class="f-w-500">Pref Contact <span class="pull-end">:</span></h5>
                            </div>
                            <div class="col-sm-9 col-7"><span>{{request_details.prefferred_contact}}</span></div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-sm-3 col-5">
                                <h5 class="f-w-500">Name <span class="pull-end">:</span></h5>
                            </div>
                            <div class="col-sm-9 col-7"><span>{{request_details.name}}</span></div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-sm-3 col-5">
                                <h5 class="f-w-500">Phone <span class="pull-end">:</span></h5>
                            </div>
                            <div class="col-sm-9 col-7"><span>{{request_details.phone}}</span></div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-sm-3 col-5">
                                <h5 class="f-w-500">Address <span class="pull-end">:</span></h5>
                            </div>
                            <div class="col-sm-9 col-7"><span>{{request_details.address}}</span></div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-sm-3 col-5">
                                <h5 class="f-w-500">City <span class="pull-end">:</span></h5>
                            </div>
                            <div class="col-sm-9 col-7"><span>{{request_details.city}}</span></div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-sm-3 col-5">
                                <h5 class="f-w-500">Pincode <span class="pull-end">:</span></h5>
                            </div>
                            <div class="col-sm-9 col-7"><span>{{request_details.pincode}}</span></div>
                        </div>
                        {% else %}
                        <p>Content hidden as the order is not accepted by you</p>
                        {% endif %}

                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <div class="product-detail-content">
                    <!--Product details-->
                    <div class="new-arrival-content pr">
                        <h4>{{request_details.phonemodel.brand_model}}</h4>
                        <p>Brand: {{request_details.phonemodel.brand_model.brand}}</p>
                        <p>RAM: {{request_details.phonemodel.RAM}}</p>
                        <p>Color: {{request_details.phonemodel.color}}</p>
                        <p>Internal Storage: {{request_details.phonemodel.internal_storage}}
                        </p>
                        <p>Min Price: {{request_details.phonemodel.min_price|intcomma}}</p>
                        <p>Max Price: {{request_details.phonemodel.max_price|intcomma}}</p>
                    </div>
                </div>
            </div>
        </div>

        {% if request_details.pickupboy %}
        <div class="card">
            <div class="card-body">
                <div class="product-detail-content">
                    <!--Product details-->
                    <div class="new-arrival-content pr">
                        <h4>Assigned to Pickup Boy : {{request_details.pickupboy}}</h4>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="card">
            <div class="card-body">
                <div class="pt-3">
                    <div class="settings-form">
                        <h4 class="text-primary">Qna </h4>
                        <ul>
                            {% for item in request_details.get_replies %}
                            <li class="row">
                                <strong class="col-md-4">{{item.question}} </strong>
                                <p>{{item.option.text}} - {{item.option.identifier}}</p>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

{% endblock %}

{% block js %}
<script>
    document.getElementById("acceptButton").addEventListener("click", function () {
        var url = this.getAttribute("data-url");
        var xhr = new XMLHttpRequest();
        xhr.open("POST", url);
        xhr.setRequestHeader("X-CSRFToken", getCookie("csrftoken"));
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                var response = JSON.parse(xhr.responseText);
                if (response.status === "success") {
                    location.reload();
                }
            }
        }
        xhr.send();
    });

    function getCookie(name) {
        var value = "; " + document.cookie;
        var parts = value.split("; " + name + "=");
        if (parts.length === 2) return parts.pop().split(";").shift();
    }


</script>
{% endblock %}
